#!/bin/bash
# æ¨¡å‹æ›´æ–°æµæ°´çº¿è„šæœ¬
# è‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„æ¨¡å‹æ›´æ–°æµç¨‹

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "================================================================================"
echo "ğŸš€ å¼€å§‹æ¨¡å‹æ›´æ–°æµç¨‹"
echo "================================================================================"

# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd "$(dirname "$0")/.."

# Step 1: å‡†å¤‡æ­£æ ·æœ¬
echo ""
echo "================================================================================"
echo "Step 1: å‡†å¤‡æ­£æ ·æœ¬"
echo "================================================================================"
python scripts/prepare_positive_samples.py
if [ $? -ne 0 ]; then
    echo "âŒ æ­£æ ·æœ¬å‡†å¤‡å¤±è´¥ï¼"
    exit 1
fi

# Step 2: å‡†å¤‡è´Ÿæ ·æœ¬
echo ""
echo "================================================================================"
echo "Step 2: å‡†å¤‡è´Ÿæ ·æœ¬"
echo "================================================================================"
python scripts/prepare_negative_samples_v2.py
if [ $? -ne 0 ]; then
    echo "âŒ è´Ÿæ ·æœ¬å‡†å¤‡å¤±è´¥ï¼"
    exit 1
fi

# Step 3: æ•°æ®è´¨é‡æ£€æŸ¥
echo ""
echo "================================================================================"
echo "Step 3: æ•°æ®è´¨é‡æ£€æŸ¥"
echo "================================================================================"
python scripts/check_sample_quality.py
if [ $? -ne 0 ]; then
    echo "âŒ æ•°æ®è´¨é‡æ£€æŸ¥å¤±è´¥ï¼"
    exit 1
fi

# Step 4: è®­ç»ƒæ–°æ¨¡å‹
echo ""
echo "================================================================================"
echo "Step 4: è®­ç»ƒæ–°æ¨¡å‹"
echo "================================================================================"
python scripts/train_xgboost_timeseries.py
if [ $? -ne 0 ]; then
    echo "âŒ æ¨¡å‹è®­ç»ƒå¤±è´¥ï¼"
    exit 1
fi

# Step 5: Walk-forwardéªŒè¯
echo ""
echo "================================================================================"
echo "Step 5: Walk-forwardéªŒè¯"
echo "================================================================================"
python scripts/walk_forward_validation.py
if [ $? -ne 0 ]; then
    echo "âŒ æ¨¡å‹éªŒè¯å¤±è´¥ï¼"
    exit 1
fi

# å®Œæˆ
echo ""
echo "================================================================================"
echo "âœ… æ¨¡å‹æ›´æ–°æµç¨‹å®Œæˆï¼"
echo "================================================================================"
echo ""
echo "ğŸ“ æ¨¡å‹æ–‡ä»¶ä½ç½®: data/models/stock_selection/"
echo "ğŸ“Š éªŒè¯ç»“æœä½ç½®: data/backtest/reports/"
echo ""
echo "ğŸ’¡ ä¸‹ä¸€æ­¥:"
echo "   1. æŸ¥çœ‹éªŒè¯ç»“æœï¼Œç¡®è®¤æ¨¡å‹è¡¨ç°"
echo "   2. å¦‚æœæ»¡æ„ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨æ–°æ¨¡å‹è¿›è¡Œé¢„æµ‹"
echo "   3. è¿è¡Œ: python scripts/weekly_prediction.py"
echo ""

