#!/bin/bash
# ç›‘æ§å·¦ä¾§æ½œåŠ›ç‰›è‚¡ç­›é€‰è¿›åº¦

LOG_FILE="logs/aiquant.log"
INTERVAL=10  # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡

echo "ğŸ” ç›‘æ§å·¦ä¾§æ½œåŠ›ç‰›è‚¡ç­›é€‰è¿›åº¦"
echo "æŒ‰ Ctrl+C é€€å‡º"
echo ""

while true; do
    # è·å–æœ€æ–°è¿›åº¦
    latest_progress=$(tail -100 "$LOG_FILE" | grep -E "è¿›åº¦:|æ‰¾åˆ°æ ·æœ¬:" | tail -1)
    
    # è·å–æ‰¾åˆ°çš„æ ·æœ¬æ•°
    sample_count=$(tail -1000 "$LOG_FILE" | grep -E "æ‰¾åˆ°æ ·æœ¬:|æ‰¾åˆ°æ­£æ ·æœ¬:" | tail -1 | grep -oE "[0-9]+" | head -1)
    
    # è·å–å½“å‰å¤„ç†çš„è‚¡ç¥¨
    current_stock=$(tail -50 "$LOG_FILE" | grep -E "å¤„ç†æ ·æœ¬|è¿›åº¦:" | tail -1)
    
    # æ¸…å±å¹¶æ˜¾ç¤º
    clear
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“Š å·¦ä¾§æ½œåŠ›ç‰›è‚¡ç­›é€‰è¿›åº¦ç›‘æ§"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "â° å½“å‰æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
    echo ""
    
    if [ -n "$latest_progress" ]; then
        echo "ğŸ“ˆ æœ€æ–°è¿›åº¦:"
        echo "$latest_progress" | sed 's/.*INFO.*| //'
    fi
    
    echo ""
    if [ -n "$sample_count" ]; then
        echo "âœ… å·²æ‰¾åˆ°æ ·æœ¬: $sample_count ä¸ª"
    else
        echo "â³ å·²æ‰¾åˆ°æ ·æœ¬: 0 ä¸ªï¼ˆå¯èƒ½è¿˜åœ¨å¤„ç†ä¸­ï¼‰"
    fi
    
    echo ""
    echo "ğŸ“ æœ€è¿‘æ—¥å¿—:"
    tail -5 "$LOG_FILE" | grep -E "è¿›åº¦|æ‰¾åˆ°æ ·æœ¬|SUCCESS|ERROR" | tail -3 | sed 's/.*| //'
    
    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "æ¯ ${INTERVAL} ç§’åˆ·æ–°ä¸€æ¬¡ï¼ŒæŒ‰ Ctrl+C é€€å‡º"
    
    sleep $INTERVAL
done

