# ============================================================================
# AIQuant 统一配置文件
# ============================================================================

# 数据配置
data:
  source: tushare
  
  # 样本准备配置
  sample_preparation:
    start_date: "20000101"      # 使用2000年以来的数据
    end_date: null              # null = 今天
    
    # 正样本条件
    positive_criteria:
      consecutive_weeks: 3       # 连续阳线周数
      total_return_threshold: 50 # 总涨幅阈值(%)
      max_return_threshold: 70   # 最高涨幅阈值(%)
      min_listing_days: 180      # 最小上市天数
    
    # 负样本条件
    negative_criteria:
      method: "same_period_other_stocks"
      sample_ratio: 1.0          # 负样本/正样本比例
  
  # 特征配置
  feature_extraction:
    lookback_days: 34            # 回看天数

# 模型配置
model:
  type: xgboost
  version: v3                    # 新版本（使用2000年以来数据）
  
  # 模型参数
  parameters:
    objective: binary:logistic
    eval_metric: logloss
    n_estimators: 100
    learning_rate: 0.1
    max_depth: 5
    subsample: 0.8
    colsample_bytree: 0.8
    gamma: 0.1
    random_state: 42
    n_jobs: -1
  
  # 训练配置
  training:
    test_size: 0.2
    time_series_split: true
    n_splits: 5
  
  # 模型保存
  save:
    directory: "data/models/stock_selection"
    auto_backup: true

# 预测配置
prediction:
  scoring:
    top_n: 50                    # 推荐股票数量
    min_probability: 0.0         # 最小概率阈值
    max_stocks_to_score: null    # null = 全部，设置数字可限制（用于测试）
  
  # 排除规则
  exclusion_rules:
    exclude_st: true             # 排除ST股票
    exclude_new_listed: true     # 排除新股
    min_listing_days: 180
    exclude_suspended: true      # 排除停牌
  
  # 财务筛选（基本面过滤）
  financial_filter:
    enabled: true                # 是否启用财务筛选
    revenue_threshold: 3.0       # 营收阈值（亿元）
    profit_years: 3              # 连续盈利年数
    net_assets_positive: true    # 净资产必须>0
    initial_candidates: 150      # 初选候选数量（筛选前）
  
  # 报告配置
  report:
    include_market_analysis: true
    include_recommendations: true
    include_risk_warnings: true
    include_financial_info: true  # 包含财务信息

# 回顾配置
review:
  periods:
    - name: "1week"
      weeks: 1
    - name: "4weeks"
      weeks: 4

# 自动化配置
automation:
  scheduler:
    enable: true
    timezone: "Asia/Shanghai"

  tasks:
    # 原有模型任务
    weekly_prediction:
      schedule: "09:00 every saturday"
      enabled: true

    weekly_review:
      schedule: "10:00 every saturday"
      enabled: true

    monthly_review:
      schedule: "09:00 on 1st"
      enabled: true

    model_check:
      schedule: "09:00 on 15th"
      enabled: true

    # 左侧潜力牛股模型任务
    left_breakout_prediction:
      schedule: "11:00 every saturday"
      enabled: true
      description: "左侧潜力牛股预测（底部震荡+预转信号）"

    left_breakout_review:
      schedule: "12:00 every saturday"
      enabled: true
      description: "左侧潜力预测回顾"

    left_breakout_model_check:
      schedule: "09:00 on 16th"
      enabled: true
      description: "左侧模型状态检查"

# 数据存储配置
data_storage:
  # SQLite缓存
  cache:
    enabled: true
    database: "data/cache/quant_data.db"
    expire_days: 7  # 超过7天重新获取最新数据（优化：减少API调用）
  
  # CSV备份
  backup:
    enabled: true                # 启用CSV备份
    directory: "data/backup"
    auto_backup: true            # 自动备份到CSV
  
  # 性能配置
  performance:
    batch_size: 100              # 批量处理大小
    use_multiprocess: false      # 是否使用多进程

# 左侧潜力牛股模型配置
left_breakout:
  # 模型基本配置
  model:
    type: xgboost
    version: v1                    # 左侧模型版本
    enabled: true                  # 是否启用左侧模型

    # 模型参数
    parameters:
      objective: binary:logistic
      eval_metric: logloss
      n_estimators: 100
      learning_rate: 0.1
      max_depth: 6
      subsample: 0.8
      colsample_bytree: 0.8
      gamma: 0.1
      random_state: 42
      n_jobs: -1

    # 训练配置
    training:
      test_size: 0.2
      time_series_split: true
      n_splits: 5
      min_train_samples: 1000      # 最少训练样本数

    # 模型保存
    save:
      directory: "data/models/left_breakout"
      auto_backup: true

  # 样本准备配置
  sample_preparation:
    start_date: "20000101"        # 使用2000年以来的数据
    end_date: null                # null = 今天
    look_forward_days: 45         # 向前看天数（45天≈1.5个月）

    # 正样本条件（左侧潜力标准）
    # 严格条件：提高样本质量，确保找到真正的左侧潜力牛股
    positive_criteria:
      future_return_threshold: 50   # 未来45天累计涨幅 > 50%（严格标准）
      past_return_threshold: 20     # 过去60天累计涨幅 < 20%（底部震荡）
      rsi_threshold: 70             # RSI < 70（未过度超买）
      volume_ratio_min: 1.5         # 量比 >= 1.5（严格标准）
      volume_ratio_max: 3.0         # 量比 <= 3.0（严格标准，温和放量）
      min_signals: 2                # 至少需要的预转信号数量（保持2个）
      min_listing_days: 180         # 最小上市天数

    # 负样本条件
    negative_criteria:
      method: "similar_features"     # 基于特征相似性的负样本选择
      sample_ratio: 1.0              # 负样本/正样本比例
      feature_similarity_threshold: 0.6  # 特征相似度阈值

  # 特征工程配置
  feature_engineering:
    lookback_days: 34              # 回看天数
    feature_categories:
      bottom_oscillation: true      # 底部震荡特征
      breakout_signals: true        # 预转信号特征
      volume_price: true            # 量价配合特征
      technical_indicators: true    # 技术指标特征
      market_context: true          # 市场环境特征

  # 验证配置
  validation:
    walk_forward:
      enabled: true
      n_splits: 5
      min_train_samples: 1000

    robustness_test:
      enabled: true
      n_bootstraps: 50
      sample_fraction: 0.8

    time_series_cv:
      enabled: true
      initial_train_size: 0.6
      test_size: 0.2
      step_size: 0.1

  # 预测配置
  prediction:
    scoring:
      top_n: 50                    # 推荐股票数量
      min_probability: 0.1         # 最小概率阈值
      max_stocks_to_score: null    # null = 全部，设置数字可限制（用于测试）

    # 筛选规则
    filters:
      exclude_st: true             # 排除ST股票
      exclude_new_listed: true     # 排除新股
      min_listing_days: 180
      exclude_suspended: true      # 排除停牌

    # 财务筛选（可选，用于进一步过滤）
    financial_filter:
      enabled: false               # 左侧模型默认不启用财务筛选（注重技术面）
      revenue_threshold: 3.0       # 营收阈值（亿元）
      profit_years: 3              # 连续盈利年数

    # 报告配置
    report:
      include_market_analysis: true
      include_recommendations: true
      include_risk_warnings: true
      include_financial_info: false  # 左侧模型不重点强调财务信息

# 日志配置
logging:
  level: INFO
  app_log: "logs/aiquant.log"
  scheduler_log: "logs/scheduler.log"

