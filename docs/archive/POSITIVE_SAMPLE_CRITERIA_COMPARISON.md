# æ­£è´Ÿæ ·æœ¬ç­›é€‰é€»è¾‘è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„ç­›é€‰é€»è¾‘ï¼Œä¸¤è€…ä½¿ç”¨ç›¸åŒçš„è¿‡æ»¤è§„åˆ™ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

---

## ğŸ”§ ç»Ÿä¸€è¿‡æ»¤è§„åˆ™

æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬å‡ä½¿ç”¨ä»¥ä¸‹è¿‡æ»¤è§„åˆ™å‰”é™¤ä¸ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨ï¼š

| è¿‡æ»¤ç±»å‹ | è¯´æ˜ | å®ç°æ–¹å¼ |
|---------|------|---------|
| **ST** | å‰”é™¤STè‚¡ç¥¨ | åç§°åŒ…å« `ST`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼Œå«STã€*STã€S*STã€SSTç­‰ï¼‰ |
| **HALT** | å‰”é™¤åœç‰Œè‚¡ç¥¨ | ä½¿ç”¨ `suspend_d` æ¥å£æŸ¥è¯¢T1æ—¥æœŸåœç‰Œçš„è‚¡ç¥¨ |
| **DELISTING** | å‰”é™¤é€€å¸‚è‚¡ç¥¨ | ä½¿ç”¨ `list_status='L'` åªè·å–ä¸Šå¸‚çŠ¶æ€çš„è‚¡ç¥¨ |
| **DELISTING_SORTING** | å‰”é™¤é€€å¸‚æ•´ç†æœŸè‚¡ç¥¨ | åç§°åŒ…å« `é€€` å­— |
| **åŒ—äº¤æ‰€** | å‰”é™¤åŒ—äº¤æ‰€è‚¡ç¥¨ | è‚¡ç¥¨ä»£ç ä»¥ `.BJ` ç»“å°¾ |
| **ä¸Šå¸‚æ—¶é—´** | ä¸Šå¸‚æ»¡180å¤© | T1æ—¥æœŸä¸ä¸Šå¸‚æ—¥æœŸé—´éš” â‰¥ 180å¤© |

---

## âœ… æ­£æ ·æœ¬ç­›é€‰æ¡ä»¶

### ä¸€ã€ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨å’ŒT1

ç­›é€‰å†å²ä¸Šæ»¡è¶³ä»¥ä¸‹**æ‰€æœ‰æ¡ä»¶**çš„è‚¡ç¥¨ï¼š

| æ¡ä»¶ | è¯´æ˜ | å®ç° |
|------|------|------|
| 1. å‘¨Kä¸‰è¿é˜³ | è¿ç»­3å‘¨æ”¶ç›˜ä»· > å¼€ç›˜ä»· | `week['close'] > week['open']` |
| 2. æ€»æ¶¨å¹… > 50% | (ç¬¬3å‘¨æ”¶ç›˜ä»· - ç¬¬1å‘¨å¼€ç›˜ä»·) / ç¬¬1å‘¨å¼€ç›˜ä»· > 50% | `total_return > 50` |
| 3. æœ€é«˜æ¶¨å¹… > 70% | (3å‘¨å†…æœ€é«˜ä»· - ç¬¬1å‘¨å¼€ç›˜ä»·) / ç¬¬1å‘¨å¼€ç›˜ä»· > 70% | `max_return > 70` |
| 4. è¿‡æ»¤è§„åˆ™ | å‰”é™¤STã€åœç‰Œã€é€€å¸‚ã€é€€å¸‚æ•´ç†æœŸã€åŒ—äº¤æ‰€ | è§ä¸Šæ–¹ç»Ÿä¸€è§„åˆ™ |
| 5. ä¸Šå¸‚æ—¶é—´ â‰¥ 180å¤© | ä¸Šå¸‚æ—¥æœŸè·ç¦»T1è‡³å°‘180å¤© | `days_since_list >= 180` |
| 6. T1å®šä¹‰ | T1 = ç¬¬ä¸€å‘¨çš„ç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥ | `t1_date = week1['trade_date']` |
| 7. å»é‡è§„åˆ™ | é‡å æ—¶é—´æ®µåˆå¹¶ï¼ˆé€‰æœ€æ—©T1ï¼‰ï¼Œä¸é‡å ä¿ç•™å¤šä¸ª | `_merge_overlapping_samples()` |

### äºŒã€ç‰¹å¾æ•°æ®

æå–**T1å‰34å¤©**çš„äº¤æ˜“æ•°æ®ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µ | è¯´æ˜ | æ¥æº |
|------|------|------|
| sample_id | æ ·æœ¬ID | è‡ªåŠ¨ç”Ÿæˆ |
| ts_code | è‚¡ç¥¨ä»£ç  | Tushare |
| name | è‚¡ç¥¨åç§° | Tushare |
| trade_date | äº¤æ˜“æ—¥æœŸ | Tushare |
| close | æ”¶ç›˜ä»· | Tushare |
| pct_chg | å½“æ—¥æ¶¨è·Œå¹…(%) | Tushare |
| total_mv | æ€»å¸‚å€¼(ä¸‡å…ƒ) | Tushare |
| circ_mv | æµé€šå¸‚å€¼(ä¸‡å…ƒ) | Tushare |
| ma5 | 5æ—¥ç§»åŠ¨å¹³å‡çº¿ | è®¡ç®— |
| ma10 | 10æ—¥ç§»åŠ¨å¹³å‡çº¿ | è®¡ç®— |
| volume_ratio | é‡æ¯” | Tushare |
| macd_dif | MACD DIF | Tushare Pro |
| macd_dea | MACD DEA | Tushare Pro |
| macd | MACDæŸ± | Tushare Pro |
| rsi_6 | 6æ—¥RSI | Tushare Pro |
| rsi_12 | 12æ—¥RSI | Tushare Pro |
| rsi_24 | 24æ—¥RSI | Tushare Pro |
| days_to_t1 | è·ç¦»T1çš„å¤©æ•° | è®¡ç®—ï¼ˆ-34åˆ°-1ï¼‰ |
| label | æ ·æœ¬æ ‡ç­¾ | 1ï¼ˆæ­£æ ·æœ¬ï¼‰ |

---

## ğŸ“‰ è´Ÿæ ·æœ¬ç­›é€‰æ¡ä»¶ï¼ˆV2 - åŒå‘¨æœŸå…¶ä»–è‚¡ç¥¨æ³•ï¼‰

### ä¸€ã€ç­›é€‰é€»è¾‘

| æ­¥éª¤ | è¯´æ˜ |
|------|------|
| 1. è·å–æ­£æ ·æœ¬T1æ—¥æœŸ | æŒ‰T1æ—¥æœŸåˆ†ç»„æ­£æ ·æœ¬ |
| 2. è·å–æœ‰æ•ˆè‚¡ç¥¨æ±  | åº”ç”¨ç»Ÿä¸€è¿‡æ»¤è§„åˆ™ï¼ˆSTã€é€€å¸‚ã€é€€å¸‚æ•´ç†æœŸã€åŒ—äº¤æ‰€ï¼‰ |
| 3. æ’é™¤æ­£æ ·æœ¬è‚¡ç¥¨ | ä»è‚¡ç¥¨æ± ä¸­æ’é™¤å·²åœ¨æ­£æ ·æœ¬ä¸­çš„è‚¡ç¥¨ |
| 4. æ£€æŸ¥ä¸Šå¸‚æ—¶é—´ | ç¡®ä¿è‚¡ç¥¨åœ¨T1æ—¥æœŸå‰å·²ä¸Šå¸‚æ»¡180å¤© |
| 5. æ£€æŸ¥åœç‰ŒçŠ¶æ€ | ä½¿ç”¨ `suspend_d` æ¥å£å‰”é™¤T1æ—¥æœŸåœç‰Œçš„è‚¡ç¥¨ |
| 6. éšæœºé€‰æ‹© | ä»ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨æ± ä¸­éšæœºé€‰æ‹©ï¼ˆæ¯ä¸ªæ­£æ ·æœ¬å¯¹åº”1ä¸ªè´Ÿæ ·æœ¬ï¼‰ |

### äºŒã€ä¸æ­£æ ·æœ¬çš„åŒºåˆ«

| æ–¹é¢ | æ­£æ ·æœ¬ | è´Ÿæ ·æœ¬ |
|------|--------|--------|
| æ¥æº | æ»¡è¶³ä¸‰è¿é˜³æ¡ä»¶çš„è‚¡ç¥¨ | åŒT1æ—¥æœŸçš„å…¶ä»–è‚¡ç¥¨ |
| è¡Œä¸š/æ¿å— | æ— é™åˆ¶ | æ— é™åˆ¶ï¼ˆä¸è€ƒè™‘è¡Œä¸šæ¿å—ï¼‰ |
| è¿‡æ»¤è§„åˆ™ | STã€åœç‰Œã€é€€å¸‚ã€é€€å¸‚æ•´ç†æœŸã€åŒ—äº¤æ‰€ | å®Œå…¨ç›¸åŒ |
| ç‰¹å¾æ•°æ® | T1å‰34å¤© | T1å‰34å¤©ï¼ˆå®Œå…¨ç›¸åŒï¼‰ |
| æ ‡ç­¾ | label=1 | label=0 |

---

## ğŸ“ ä»£ç ä½ç½®

### æ­£æ ·æœ¬ç­›é€‰å™¨

```
src/models/screening/positive_sample_screener.py
```

å…³é”®æ–¹æ³•ï¼š
- `_get_valid_stock_list()`: è·å–æœ‰æ•ˆè‚¡ç¥¨åˆ—è¡¨ï¼ˆåº”ç”¨STã€é€€å¸‚ã€é€€å¸‚æ•´ç†æœŸã€åŒ—äº¤æ‰€è¿‡æ»¤ï¼‰
- `_check_three_week_pattern()`: æ£€æŸ¥ä¸‰å‘¨æ¨¡å¼ï¼ˆåŒ…å«åœç‰Œæ£€æŸ¥ï¼‰
- `_merge_overlapping_samples()`: å¤„ç†é‡å æ—¶é—´æ®µå»é‡

### è´Ÿæ ·æœ¬ç­›é€‰å™¨

```
src/models/screening/negative_sample_screener_v2.py
```

å…³é”®æ–¹æ³•ï¼š
- `_get_valid_stock_list()`: è·å–æœ‰æ•ˆè‚¡ç¥¨åˆ—è¡¨ï¼ˆä¸æ­£æ ·æœ¬ç›¸åŒçš„è¿‡æ»¤è§„åˆ™ï¼‰
- `screen_negative_samples()`: ç­›é€‰è´Ÿæ ·æœ¬ï¼ˆåŒ…å«åœç‰Œæ£€æŸ¥ï¼‰

---

## ğŸ” è¿‡æ»¤è§„åˆ™å®ç°è¯¦æƒ…

### 1. STè¿‡æ»¤

```python
# å‰”é™¤STè‚¡ç¥¨ï¼ˆSTã€*STã€S*STã€SSTç­‰ï¼‰
st_mask = stock_list['name'].str.contains('ST', na=False, case=False)
stock_list = stock_list[~st_mask]
```

### 2. HALTï¼ˆåœç‰Œï¼‰è¿‡æ»¤

```python
# ä½¿ç”¨suspend_dæ¥å£æŸ¥è¯¢T1æ—¥æœŸåœç‰Œçš„è‚¡ç¥¨
suspend_info = self.dm.get_suspend_info(trade_date=t1_date_str, suspend_type='S')
if not suspend_info.empty:
    suspended_stocks = set(suspend_info['ts_code'].tolist())
    eligible_stocks = eligible_stocks[~eligible_stocks['ts_code'].isin(suspended_stocks)]
```

### 3. DELISTINGï¼ˆé€€å¸‚ï¼‰è¿‡æ»¤

```python
# ä½¿ç”¨list_status='L'åªè·å–ä¸Šå¸‚è‚¡ç¥¨
stock_list = self.dm.get_stock_list(list_status='L')
```

### 4. DELISTING_SORTINGï¼ˆé€€å¸‚æ•´ç†æœŸï¼‰è¿‡æ»¤

```python
# å‰”é™¤åç§°åŒ…å«"é€€"çš„è‚¡ç¥¨
delisting_sorting_mask = stock_list['name'].str.contains('é€€', na=False)
stock_list = stock_list[~delisting_sorting_mask]
```

### 5. åŒ—äº¤æ‰€è¿‡æ»¤

```python
# å‰”é™¤ä»£ç ä»¥.BJç»“å°¾çš„è‚¡ç¥¨
bj_mask = stock_list['ts_code'].str.endswith('.BJ')
stock_list = stock_list[~bj_mask]
```

### 6. ä¸Šå¸‚æ—¶é—´è¿‡æ»¤

```python
# è‡³å°‘ä¸Šå¸‚180å¤©
days_since_list = (t1_date - list_date).days
if days_since_list < 180:
    return None
```

---

## ğŸ“Š æ—¥å¿—è¾“å‡ºç¤ºä¾‹

è¿è¡Œç­›é€‰è„šæœ¬æ—¶ï¼Œä¼šè¾“å‡ºè¯¦ç»†çš„è¿‡æ»¤ç»Ÿè®¡ï¼š

```
è‚¡ç¥¨è¿‡æ»¤ç»Ÿè®¡:
  åŸå§‹æ•°é‡: 5500
  å‰”é™¤ST: 120
  å‰”é™¤åŒ—äº¤æ‰€: 280
  å‰”é™¤é€€å¸‚æ•´ç†æœŸ: 5
  æœ‰æ•ˆè‚¡ç¥¨: 5095
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-28  
**æœ€åæ›´æ–°**: 2025-12-30
