# åŸå§‹æ•°æ®å­—æ®µè¯´æ˜

## ğŸ“‹ æ•°æ®æ–‡ä»¶

- **æ­£æ ·æœ¬ç‰¹å¾æ•°æ®**: `data/training/features/feature_data_34d.csv`
- **è´Ÿæ ·æœ¬ç‰¹å¾æ•°æ®**: `data/training/features/negative_feature_data_v2_34d.csv`

## âœ… åŸå§‹æ•°æ®å­—æ®µç¡®è®¤

æ ¹æ®å®é™…æ•°æ®æ–‡ä»¶å’Œä»£ç ï¼ŒåŸå§‹æ•°æ®åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

### åŸºç¡€å­—æ®µï¼ˆå¿…é€‰ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `sample_id` | int | æ ·æœ¬ID | 0, 1, 2, ... | ç”Ÿæˆ |
| `trade_date` | str | äº¤æ˜“æ—¥æœŸ | '2015-10-19' | Tushare |
| `name` | str | è‚¡ç¥¨åç§° | 'ä¸‡ç§‘A' | Tushare |
| `ts_code` | str | è‚¡ç¥¨ä»£ç  | '000002.SZ' | Tushare |
| `days_to_t1` | int | è·ç¦»T1çš„å¤©æ•° | -34, -33, ..., -1 | è®¡ç®— |

### ä»·æ ¼å’Œæ¶¨è·Œå¹…å­—æ®µï¼ˆå¿…é€‰ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `close` | float | æ”¶ç›˜ä»·ï¼ˆå…ƒï¼‰ | 10.6 | Tushare |
| `pct_chg` | float | å½“æ—¥æ¶¨è·Œå¹…(%) | -0.84 | Tushare |

### å¸‚å€¼å­—æ®µï¼ˆå¿…é€‰ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `total_mv` | float | æ€»å¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ | 14950122.74 | Tushare |
| `circ_mv` | float | æµé€šå¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ | 13150169.38 | Tushare |

### æŠ€æœ¯æŒ‡æ ‡å­—æ®µï¼ˆå¿…é€‰ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `ma5` | float | 5æ—¥å‡çº¿ | 10.57 | è®¡ç®—/Tushare |
| `ma10` | float | 10æ—¥å‡çº¿ | 10.38 | è®¡ç®—/Tushare |
| `volume_ratio` | float | é‡æ¯” | 1.25 | è®¡ç®— |

### MACDå­—æ®µï¼ˆå¯é€‰ï¼Œå¦‚æœTushareæŠ€æœ¯å› å­å¯ç”¨ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `macd_dif` | float | MACD DIFçº¿ | 0.12 | TushareæŠ€æœ¯å› å­ |
| `macd_dea` | float | MACD DEAçº¿ | 0.08 | TushareæŠ€æœ¯å› å­ |
| `macd` | float | MACDæŸ±çŠ¶å›¾ | 0.04 | TushareæŠ€æœ¯å› å­ |

### RSIå­—æ®µï¼ˆå¯é€‰ï¼Œå¦‚æœTushareæŠ€æœ¯å› å­å¯ç”¨ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `rsi_6` | float | 6æ—¥RSI | 58.3 | TushareæŠ€æœ¯å› å­ |
| `rsi_12` | float | 12æ—¥RSI | 56.2 | TushareæŠ€æœ¯å› å­ |
| `rsi_24` | float | 24æ—¥RSI | 54.1 | TushareæŠ€æœ¯å› å­ |

### æ ‡ç­¾å­—æ®µï¼ˆä»…è´Ÿæ ·æœ¬æ–‡ä»¶ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ¥æº |
|--------|------|------|--------|------|
| `label` | int | æ ‡ç­¾ï¼ˆ0=è´Ÿæ ·æœ¬ï¼Œ1=æ­£æ ·æœ¬ï¼‰ | 0 | ç”Ÿæˆ |

---

## ğŸ“Š æ•°æ®æ ¼å¼ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ï¼ˆåŒ…å«æ‰€æœ‰å­—æ®µï¼‰

```python
{
    'sample_id': 0,
    'trade_date': '2015-10-19',      # æˆ– '20241001' æ ¼å¼
    'name': 'ä¸‡ç§‘A',
    'ts_code': '000002.SZ',
    'close': 10.6,                    # æ”¶ç›˜ä»· 10.6å…ƒ
    'pct_chg': -0.84,                 # å½“æ—¥ä¸‹è·Œ 0.84%
    'total_mv': 14950122.74,           # æ€»å¸‚å€¼ 1495äº¿å…ƒï¼ˆä¸‡å…ƒå•ä½ï¼‰
    'circ_mv': 13150169.38,            # æµé€šå¸‚å€¼ 1315äº¿å…ƒï¼ˆä¸‡å…ƒå•ä½ï¼‰
    'ma5': 10.57,                      # 5æ—¥å‡çº¿ 10.57å…ƒ
    'ma10': 10.38,                     # 10æ—¥å‡çº¿ 10.38å…ƒ
    'volume_ratio': 1.25,              # é‡æ¯” 1.25ï¼ˆæ¸©å’Œæ”¾é‡ï¼‰
    'macd_dif': 0.12,                  # MACD DIF ä¸ºæ­£ï¼ˆä¸Šæ¶¨åŠ¨èƒ½ï¼‰
    'macd_dea': 0.08,                  # MACD DEA
    'macd': 0.04,                      # MACDæŸ±ä¸ºæ­£ï¼ˆåŠ¨èƒ½å¢å¼ºï¼‰
    'rsi_6': 58.3,                     # 6æ—¥RSI 58.3ï¼ˆä¸­æ€§åå¼ºï¼‰
    'rsi_12': 56.2,                    # 12æ—¥RSI 56.2
    'rsi_24': 54.1,                    # 24æ—¥RSI 54.1
    'days_to_t1': -34                  # è·ç¦»T1è¿˜æœ‰34å¤©
}
```

### CSVæ ¼å¼

```csv
sample_id,trade_date,name,ts_code,close,pct_chg,total_mv,circ_mv,ma5,ma10,volume_ratio,macd_dif,macd_dea,macd,rsi_6,rsi_12,rsi_24,days_to_t1
0,2015-10-19,ä¸‡ç§‘A,000002.SZ,10.6,-0.84,14950122.74,13150169.38,10.57,10.38,1.25,0.12,0.08,0.04,58.3,56.2,54.1,-34
```

---

## ğŸ” å­—æ®µè¯´æ˜

### 1. åŸºç¡€å­—æ®µ

- **sample_id**: æ¯ä¸ªæ ·æœ¬çš„å”¯ä¸€IDï¼ŒåŒä¸€ä¸ªæ ·æœ¬çš„34å¤©æ•°æ®å…±äº«ç›¸åŒçš„sample_id
- **trade_date**: äº¤æ˜“æ—¥æœŸï¼Œæ ¼å¼ä¸º 'YYYY-MM-DD' æˆ– 'YYYYMMDD'
- **name**: è‚¡ç¥¨åç§°
- **ts_code**: è‚¡ç¥¨ä»£ç ï¼Œæ ¼å¼ä¸º '000002.SZ' æˆ– '600000.SH'
- **days_to_t1**: è·ç¦»T1æ—¥æœŸçš„å¤©æ•°ï¼ŒèŒƒå›´ä» -34 åˆ° -1

### 2. ä»·æ ¼å­—æ®µ

- **close**: æ”¶ç›˜ä»·ï¼ˆå…ƒï¼‰ï¼Œå·²å¤æƒ
- **pct_chg**: å½“æ—¥æ¶¨è·Œå¹…ï¼ˆ%ï¼‰ï¼Œæ­£æ•°è¡¨ç¤ºä¸Šæ¶¨ï¼Œè´Ÿæ•°è¡¨ç¤ºä¸‹è·Œ

### 3. å¸‚å€¼å­—æ®µ

- **total_mv**: æ€»å¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ï¼Œä¾‹å¦‚ 14950122.74 è¡¨ç¤ºçº¦ 1495 äº¿å…ƒ
- **circ_mv**: æµé€šå¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ï¼Œä¾‹å¦‚ 13150169.38 è¡¨ç¤ºçº¦ 1315 äº¿å…ƒ

### 4. æŠ€æœ¯æŒ‡æ ‡å­—æ®µ

- **ma5**: 5æ—¥ç§»åŠ¨å¹³å‡çº¿ï¼ˆå…ƒï¼‰
- **ma10**: 10æ—¥ç§»åŠ¨å¹³å‡çº¿ï¼ˆå…ƒï¼‰
- **volume_ratio**: é‡æ¯”ï¼Œå½“æ—¥æˆäº¤é‡ä¸è¿‡å»Næ—¥å¹³å‡æˆäº¤é‡çš„æ¯”å€¼

### 5. MACDå­—æ®µï¼ˆå¯é€‰ï¼‰

- **macd_dif**: MACD DIFçº¿ï¼ˆå¿«çº¿ï¼‰
- **macd_dea**: MACD DEAçº¿ï¼ˆæ…¢çº¿ï¼‰
- **macd**: MACDæŸ±çŠ¶å›¾ = (DIF - DEA) Ã— 2

**æ³¨æ„**: è¿™äº›å­—æ®µå¯èƒ½ä¸å­˜åœ¨ï¼Œå–å†³äºTushareæŠ€æœ¯å› å­æ•°æ®æ˜¯å¦å¯ç”¨ã€‚

### 6. RSIå­—æ®µï¼ˆå¯é€‰ï¼‰

- **rsi_6**: 6æ—¥ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
- **rsi_12**: 12æ—¥ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
- **rsi_24**: 24æ—¥ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡

**æ³¨æ„**: è¿™äº›å­—æ®µå¯èƒ½ä¸å­˜åœ¨ï¼Œå–å†³äºTushareæŠ€æœ¯å› å­æ•°æ®æ˜¯å¦å¯ç”¨ã€‚

---

## ğŸ“ æ•°æ®è·å–é€»è¾‘

åœ¨ `src/strategy/screening/positive_sample_screener.py` çš„ `_extract_single_sample_features()` æ–¹æ³•ä¸­ï¼š

```python
# 1. è·å–åŸºç¡€è¡Œæƒ…æ•°æ®ï¼ˆåŒ…å«æ”¶ç›˜ä»·ã€æ¶¨è·Œå¹…ã€å¸‚å€¼ç­‰ï¼‰
df = self.dm.get_complete_data(ts_code, start_date, end_date)

# 2. è·å–TushareæŠ€æœ¯å› å­ï¼ˆåŒ…å«MACDã€RSIç­‰ï¼‰
df_factor = self.dm.get_stk_factor(ts_code, start_date, end_date)
df = pd.merge(df, df_factor, on='trade_date', how='left')

# 3. è®¡ç®—ç§»åŠ¨å¹³å‡çº¿å’Œé‡æ¯”
if 'ma5' not in df.columns:
    df['ma5'] = df['close'].rolling(window=5).mean()
if 'ma10' not in df.columns:
    df['ma10'] = df['close'].rolling(window=10).mean()

# 4. é€‰æ‹©éœ€è¦çš„å­—æ®µ
base_fields = [
    'trade_date', 'ts_code', 'close', 'pct_chg',
    'total_mv', 'circ_mv', 'ma5', 'ma10', 'volume_ratio'
]

# 5. å¦‚æœæœ‰æŠ€æœ¯å› å­ï¼Œä¹ŸåŒ…å«è¿›æ¥
extra_fields = []
for field in ['macd_dif', 'macd_dea', 'macd', 'rsi_6', 'rsi_12', 'rsi_24']:
    if field in df.columns:
        extra_fields.append(field)
```

---

## âœ… ç¡®è®¤ç»“æœ

**æ‚¨æä¾›çš„æ•°æ®æ ¼å¼æ˜¯æ­£ç¡®çš„ï¼** âœ…

æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨äºåŸå§‹æ•°æ®æ–‡ä»¶ä¸­ï¼š
- âœ… åŸºç¡€å­—æ®µï¼šsample_id, trade_date, name, ts_code, days_to_t1
- âœ… ä»·æ ¼å­—æ®µï¼šclose, pct_chg
- âœ… å¸‚å€¼å­—æ®µï¼štotal_mv, circ_mv
- âœ… æŠ€æœ¯æŒ‡æ ‡ï¼šma5, ma10, volume_ratio
- âœ… MACDå­—æ®µï¼šmacd_dif, macd_dea, macdï¼ˆå¦‚æœå¯ç”¨ï¼‰
- âœ… RSIå­—æ®µï¼šrsi_6, rsi_12, rsi_24ï¼ˆå¦‚æœå¯ç”¨ï¼‰

**æ³¨æ„**ï¼š
1. `trade_date` æ ¼å¼å¯èƒ½æ˜¯ 'YYYY-MM-DD' æˆ– 'YYYYMMDD'ï¼Œå–å†³äºæ•°æ®æ¥æº
2. MACDå’ŒRSIå­—æ®µæ˜¯**å¯é€‰çš„**ï¼Œå¦‚æœTushareæŠ€æœ¯å› å­æ•°æ®ä¸å¯ç”¨ï¼Œè¿™äº›å­—æ®µå¯èƒ½ä¸å­˜åœ¨
3. å¸‚å€¼å•ä½æ˜¯**ä¸‡å…ƒ**ï¼Œä¸æ˜¯å…ƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-28  
**æœ€åæ›´æ–°**: 2025-12-28

