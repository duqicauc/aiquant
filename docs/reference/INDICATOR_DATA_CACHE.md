# æŒ‡æ ‡æ•°æ®ç¼“å­˜ä½¿ç”¨è¯´æ˜

## âœ… æŒ‡æ ‡æ•°æ®è·å–ä½¿ç”¨ç¼“å­˜

**æ˜¯çš„ï¼Œè·å–æŒ‡æ ‡æ•°æ®ä½¿ç”¨äº†ç¼“å­˜æœºåˆ¶ã€‚**

---

## ğŸ“Š æ”¯æŒçš„æŒ‡æ ‡æ•°æ®ç±»å‹

### 1. æ¯æ—¥æŒ‡æ ‡ï¼ˆdaily_basicï¼‰âœ…

**ä»£ç ä½ç½®**: `src/data/fetcher/tushare_fetcher.py:282-314`

**åŒ…å«æ•°æ®**:
- `turnover_rate` - æ¢æ‰‹ç‡
- `volume_ratio` - é‡æ¯”
- `total_mv` - æ€»å¸‚å€¼
- `circ_mv` - æµé€šå¸‚å€¼
- `pe` - å¸‚ç›ˆç‡
- `pb` - å¸‚å‡€ç‡

**ç¼“å­˜é€»è¾‘**:
```python
def get_daily_basic(self, stock_code, start_date, end_date):
    # 1. æ£€æŸ¥ç¼“å­˜
    if self.use_cache and self.cache:
        if self.cache.has_data(stock_code, 'daily_basic', start_date, end_date):
            df = self.cache.get_data(...)  # ä»ç¼“å­˜è¯»å–
            return df
    
    # 2. ä»APIè·å–æ•°æ®
    df = self._fetch_daily_basic_from_api(...)
    
    # 3. ä¿å­˜åˆ°ç¼“å­˜
    if self.use_cache and self.cache and not df.empty:
        self.cache.save_data(df, 'daily_basic', stock_code)
    
    return df
```

**ç¼“å­˜è¡¨**: `daily_basic`

---

### 2. æŠ€æœ¯å› å­ï¼ˆstk_factorï¼‰âœ…

**ä»£ç ä½ç½®**: `src/data/fetcher/tushare_fetcher.py:493-555`

**åŒ…å«æ•°æ®**:
- **MACDæŒ‡æ ‡**: `macd_dif`, `macd_dea`, `macd`
- **RSIæŒ‡æ ‡**: `rsi_6`, `rsi_12`, `rsi_24`
- **KDJæŒ‡æ ‡**: `kdj_k`, `kdj_d`, `kdj_j`
- **å¸ƒæ—å¸¦**: `boll_upper`, `boll_mid`, `boll_lower`
- **å‡çº¿**: `ma_5`, `ma_10`, `ma_20`, `ma_60`
- **å…¶ä»–**: `cci`, `adx`, `adxr`, `atr`

**ç¼“å­˜é€»è¾‘**:
```python
def get_stk_factor(self, stock_code, start_date, end_date):
    # 1. æ£€æŸ¥ç¼“å­˜
    if self.use_cache and self.cache:
        if self.cache.has_data(stock_code, 'stk_factor', start_date, end_date):
            df = self.cache.get_data(...)  # ä»ç¼“å­˜è¯»å–
            return df
    
    # 2. ä»APIè·å–æ•°æ®
    df = self._fetch_stk_factor_from_api(...)
    
    # 3. ä¿å­˜åˆ°ç¼“å­˜
    if self.use_cache and self.cache and not df.empty:
        self.cache.save_data(df, 'stk_factor', stock_code)
    
    return df
```

**ç¼“å­˜è¡¨**: `stk_factor`

---

## ğŸ”„ æ‰¹é‡è·å–æŒ‡æ ‡æ•°æ®

### æ‰¹é‡è·å–æ¯æ—¥æŒ‡æ ‡ï¼ˆbatch_get_daily_basicï¼‰

**ä»£ç ä½ç½®**: `src/data/fetcher/tushare_fetcher.py:339-408`

**ä¸¤ç§æ¨¡å¼**:

#### æ¨¡å¼1ï¼šè‚¡ç¥¨æ•°é‡ < 100ï¼ˆä½¿ç”¨å¹¶å‘ï¼‰

```python
# å¹¶å‘è°ƒç”¨ get_daily_basicï¼ˆæ¯ä¸ªéƒ½ä¼šä½¿ç”¨ç¼“å­˜ï¼‰
for code in stock_codes:
    df = self.get_daily_basic(code, trade_date, trade_date)  # ä½¿ç”¨ç¼“å­˜
```

#### æ¨¡å¼2ï¼šè‚¡ç¥¨æ•°é‡ >= 100ï¼ˆä¸€æ¬¡APIè°ƒç”¨ï¼‰

```python
# ä¸€æ¬¡APIè°ƒç”¨è·å–æ‰€æœ‰è‚¡ç¥¨æŸä¸€å¤©çš„æ•°æ®
df = self.pro.daily_basic(trade_date=trade_date)  # ä¸ä¼ ts_code

# ä¿å­˜åˆ°ç¼“å­˜ï¼ˆæŒ‰è‚¡ç¥¨ä»£ç åˆ†ç»„ï¼‰
for ts_code, group_df in df.groupby('ts_code'):
    self.cache.save_data(group_df, 'daily_basic', ts_code)
```

**ä¼˜åŠ¿**: 
- æ¨¡å¼1ï¼šå……åˆ†åˆ©ç”¨ç¼“å­˜ï¼Œå·²ç¼“å­˜çš„æ•°æ®ä¸è°ƒç”¨API
- æ¨¡å¼2ï¼šä¸€æ¬¡APIè°ƒç”¨è·å–æ‰€æœ‰è‚¡ç¥¨ï¼Œç„¶åä¿å­˜åˆ°ç¼“å­˜

---

## ğŸ“¦ ç¼“å­˜å­˜å‚¨

### ç¼“å­˜ä½ç½®

- **æ•°æ®åº“**: `data/cache/quant_data.db` (SQLite)
- **è¡¨å**: 
  - `daily_basic` - æ¯æ—¥æŒ‡æ ‡
  - `stk_factor` - æŠ€æœ¯å› å­

### ç¼“å­˜è¿‡æœŸ

- **é»˜è®¤è¿‡æœŸæ—¶é—´**: 7å¤©
- **é…ç½®ä½ç½®**: `config/settings.yaml`
  ```yaml
  data_storage:
    cache:
      expire_days: 7  # è¶…è¿‡7å¤©é‡æ–°è·å–æœ€æ–°æ•°æ®
  ```

---

## ğŸ” ç¼“å­˜å·¥ä½œæµç¨‹

### æ¯æ—¥æŒ‡æ ‡ï¼ˆdaily_basicï¼‰

```
é¦–æ¬¡è·å–ï¼š
  è°ƒç”¨API â†’ ä¿å­˜åˆ°ç¼“å­˜ â†’ è¿”å›æ•°æ®

å†æ¬¡è·å–ï¼ˆç›¸åŒæ•°æ®ï¼‰ï¼š
  æ£€æŸ¥ç¼“å­˜ â†’ ç›´æ¥ä»ç¼“å­˜è¯»å– âš¡ â†’ è¿”å›æ•°æ®

æ‰¹é‡è·å–ï¼ˆæ¨¡å¼1ï¼‰ï¼š
  å¾ªç¯è°ƒç”¨ get_daily_basic â†’ æ¯ä¸ªéƒ½æ£€æŸ¥ç¼“å­˜ â†’ å·²ç¼“å­˜çš„ä¸è°ƒç”¨API

æ‰¹é‡è·å–ï¼ˆæ¨¡å¼2ï¼‰ï¼š
  ä¸€æ¬¡APIè°ƒç”¨è·å–æ‰€æœ‰è‚¡ç¥¨ â†’ æŒ‰è‚¡ç¥¨åˆ†ç»„ä¿å­˜åˆ°ç¼“å­˜
```

### æŠ€æœ¯å› å­ï¼ˆstk_factorï¼‰

```
é¦–æ¬¡è·å–ï¼š
  è°ƒç”¨API â†’ ä¿å­˜åˆ°ç¼“å­˜ â†’ è¿”å›æ•°æ®

å†æ¬¡è·å–ï¼ˆç›¸åŒæ•°æ®ï¼‰ï¼š
  æ£€æŸ¥ç¼“å­˜ â†’ ç›´æ¥ä»ç¼“å­˜è¯»å– âš¡ â†’ è¿”å›æ•°æ®
```

---

## ğŸ“Š æ€§èƒ½æå‡

### å•ä¸ªè‚¡ç¥¨æŒ‡æ ‡æ•°æ®

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| **é¦–æ¬¡è·å–** | 3ç§’ | 3ç§’ | ç›¸åŒ |
| **å†æ¬¡è·å–** | 3ç§’ | 0.03ç§’ | **100å€** âš¡ |

### æ‰¹é‡è·å–ï¼ˆ100åªè‚¡ç¥¨ï¼‰

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| **é¦–æ¬¡è·å–** | 300ç§’ | 300ç§’ | ç›¸åŒ |
| **å†æ¬¡è·å–** | 300ç§’ | 3ç§’ | **100å€** âš¡ |

---

## ğŸ’¡ åœ¨é¢„æµ‹è„šæœ¬ä¸­çš„ä½¿ç”¨

åœ¨ `scripts/score_current_stocks.py` ä¸­ï¼š

```python
# æ‰¹é‡è·å–æ¯æ—¥æŒ‡æ ‡
df_all_daily_basic = dm.batch_get_daily_basic(target_date_str, stock_codes)
```

**è¿™ä¸ªè°ƒç”¨ä¼šä½¿ç”¨ç¼“å­˜**ï¼š
- å¦‚æœè‚¡ç¥¨æ•°é‡ < 100ï¼šæ¯ä¸ªè‚¡ç¥¨è°ƒç”¨ `get_daily_basic`ï¼Œéƒ½ä¼šæ£€æŸ¥ç¼“å­˜
- å¦‚æœè‚¡ç¥¨æ•°é‡ >= 100ï¼šä¸€æ¬¡APIè°ƒç”¨è·å–æ‰€æœ‰è‚¡ç¥¨ï¼Œç„¶åä¿å­˜åˆ°ç¼“å­˜

---

## âœ… æ€»ç»“

### æŒ‡æ ‡æ•°æ®ç¼“å­˜çŠ¶æ€

| æ•°æ®ç±»å‹ | ç¼“å­˜æ”¯æŒ | ç¼“å­˜è¡¨ | æ‰¹é‡è·å–ç¼“å­˜ |
|---------|---------|--------|------------|
| **æ¯æ—¥æŒ‡æ ‡** (daily_basic) | âœ… æ˜¯ | `daily_basic` | âœ… æ˜¯ |
| **æŠ€æœ¯å› å­** (stk_factor) | âœ… æ˜¯ | `stk_factor` | âœ… æ˜¯ï¼ˆé€šè¿‡å•ä¸ªè·å–ï¼‰ |

### ç¼“å­˜ä¼˜åŠ¿

1. âœ… **æ€§èƒ½æå‡**: ç¼“å­˜å‘½ä¸­æ—¶é€Ÿåº¦æå‡100å€
2. âœ… **APIé…é¢èŠ‚çœ**: å·²ç¼“å­˜çš„æ•°æ®ä¸è°ƒç”¨API
3. âœ… **æ™ºèƒ½æ›´æ–°**: åªè·å–ç¼ºå¤±çš„æ•°æ®ï¼Œæ”¯æŒå¢é‡æ›´æ–°
4. âœ… **è‡ªåŠ¨ç®¡ç†**: 7å¤©åè‡ªåŠ¨è¿‡æœŸï¼Œç¡®ä¿æ•°æ®æ–°é²œåº¦

### éªŒè¯ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ

æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š
```
âœ“ ä»ç¼“å­˜è¯»å–æ•°æ®: 600519.SH daily_basic (242æ¡)
âœ“ ä»ç¼“å­˜è¯»å–æ•°æ®: 600519.SH stk_factor (242æ¡)
```

æˆ–æŸ¥çœ‹åˆå§‹åŒ–ä¿¡æ¯ï¼š
```
âœ“ Tushareæ•°æ®æºå·²åˆå§‹åŒ– (ç¼“å­˜: å·²å¯ç”¨, ç§¯åˆ†: 5000)
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-28

