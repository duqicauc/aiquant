# APIå‚è€ƒæ–‡æ¡£ - åŸºäºTushareå®˜æ–¹æ–‡æ¡£

æœ¬æ–‡æ¡£è¯´æ˜äº†æˆ‘ä»¬çš„å®ç°ä¸ [Tushareå®˜æ–¹æ–‡æ¡£](https://tushare.pro/document/2) çš„å¯¹åº”å…³ç³»ã€‚

## ğŸ“‹ æ•°æ®æ¥æºæ˜ å°„

### 1. è¡Œæƒ…æ•°æ® - é€šç”¨è¡Œæƒ…æ¥å£ï¼ˆpro_barï¼‰

**å®˜æ–¹æ–‡æ¡£**: https://tushare.pro/document/2?doc_id=109

**æˆ‘ä»¬çš„å®ç°**: `DataFetcher.get_stock_data()`

```python
# å®˜æ–¹ç¤ºä¾‹
df = ts.pro_bar(
    ts_code='000001.SZ',
    asset='E',
    adj='qfq',
    start_date='20240101',
    end_date='20241231'
)

# æˆ‘ä»¬çš„å°è£…
fetcher = DataFetcher(source='tushare')
df = fetcher.get_stock_data(
    stock_code='000001',  # è‡ªåŠ¨æ·»åŠ .SZåç¼€
    start_date='20240101',
    end_date='20241231',
    adjust='qfq'
)
```

**è¾“å‡ºå­—æ®µå¯¹ç…§**ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰:

| å®˜æ–¹å­—æ®µ | ç±»å‹ | è¯´æ˜ | æˆ‘ä»¬çš„åˆ—å |
|---------|------|------|----------|
| ts_code | str | è‚¡ç¥¨ä»£ç  | ts_code |
| trade_date | str | äº¤æ˜“æ—¥æœŸ | trade_date |
| open | float | å¼€ç›˜ä»· | open |
| high | float | æœ€é«˜ä»· | high |
| low | float | æœ€ä½ä»· | low |
| close | float | æ”¶ç›˜ä»· | close |
| pre_close | float | æ˜¨æ”¶ä»· | pre_close |
| change | float | æ¶¨è·Œé¢ | change |
| pct_chg | float | æ¶¨è·Œå¹…ï¼ˆ%ï¼‰ | pct_chg |
| vol | float | æˆäº¤é‡ï¼ˆæ‰‹ï¼‰ | vol |
| amount | float | æˆäº¤é¢ï¼ˆåƒå…ƒï¼‰ | amount |

### 2. æ¯æ—¥æŒ‡æ ‡æ•°æ® - daily_basicæ¥å£

**å®˜æ–¹æ–‡æ¡£**: https://tushare.pro/document/2?doc_id=32

**æˆ‘ä»¬çš„å®ç°**: `DataFetcher.get_daily_basic()`

```python
# å®˜æ–¹ç¤ºä¾‹
pro = ts.pro_api()
df = pro.daily_basic(
    ts_code='000001.SZ',
    start_date='20240101',
    end_date='20241231',
    fields='ts_code,trade_date,turnover_rate,volume_ratio,total_mv,circ_mv'
)

# æˆ‘ä»¬çš„å°è£…
fetcher = DataFetcher(source='tushare')
df = fetcher.get_daily_basic(
    stock_code='000001',
    start_date='20240101',
    end_date='20241231'
)
```

**è¾“å‡ºå­—æ®µå¯¹ç…§**ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰:

| å®˜æ–¹å­—æ®µ | ç±»å‹ | è¯´æ˜ | æˆ‘ä»¬çš„åˆ—å |
|---------|------|------|----------|
| ts_code | str | TSè‚¡ç¥¨ä»£ç  | ts_code |
| trade_date | str | äº¤æ˜“æ—¥æœŸ | trade_date |
| close | float | å½“æ—¥æ”¶ç›˜ä»· | - |
| turnover_rate | float | æ¢æ‰‹ç‡ï¼ˆ%ï¼‰ | turnover_rate |
| volume_ratio | float | é‡æ¯” | volume_ratio |
| pe | float | å¸‚ç›ˆç‡ | - |
| pe_ttm | float | å¸‚ç›ˆç‡TTM | - |
| pb | float | å¸‚å‡€ç‡ | - |
| total_mv | float | æ€»å¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ | total_mv |
| circ_mv | float | æµé€šå¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰ | circ_mv |

### 3. å®Œæ•´æ•°æ®è·å–

**æˆ‘ä»¬çš„å®ç°**: `StockAnalyzer.get_complete_data()`

è¿™ä¸ªæ–¹æ³•æ•´åˆäº†ä»¥ä¸Šä¸¤ä¸ªæ¥å£ï¼Œå¹¶æ·»åŠ äº†æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼š

```python
analyzer = StockAnalyzer(source='tushare')
df = analyzer.get_complete_data(
    stock_code='000001',
    start_date='20240101',
    end_date='20241231',
    adjust='qfq'
)
```

**è¿”å›çš„å®Œæ•´å­—æ®µ**:

| å­—æ®µå | æ•°æ®æ¥æº | è¯´æ˜ | å•ä½ |
|-------|---------|------|------|
| **åŸºç¡€è¡Œæƒ…æ•°æ®**ï¼ˆæ¥è‡ªpro_barï¼‰ ||||
| trade_date | pro_bar | äº¤æ˜“æ—¥æœŸ | - |
| ts_code | pro_bar | è‚¡ç¥¨ä»£ç  | - |
| open | pro_bar | å¼€ç›˜ä»· | å…ƒ |
| high | pro_bar | æœ€é«˜ä»· | å…ƒ |
| low | pro_bar | æœ€ä½ä»· | å…ƒ |
| close | pro_bar | æ”¶ç›˜ä»· | å…ƒ |
| pct_chg | pro_bar | æ¶¨è·Œå¹… | % |
| vol | pro_bar | æˆäº¤é‡ | æ‰‹ |
| amount | pro_bar | æˆäº¤é¢ | åƒå…ƒ |
| **å¸‚å€¼æ•°æ®**ï¼ˆæ¥è‡ªdaily_basicï¼‰ ||||
| total_mv | daily_basic | æ€»å¸‚å€¼ | ä¸‡å…ƒ |
| circ_mv | daily_basic | æµé€šå¸‚å€¼ | ä¸‡å…ƒ |
| volume_ratio | daily_basic | é‡æ¯” | - |
| **æŠ€æœ¯æŒ‡æ ‡**ï¼ˆæœ¬åœ°è®¡ç®—ï¼‰ ||||
| ma5 | æœ¬åœ°è®¡ç®— | 5æ—¥ç§»åŠ¨å¹³å‡çº¿ | å…ƒ |
| ma20 | æœ¬åœ°è®¡ç®— | 20æ—¥ç§»åŠ¨å¹³å‡çº¿ | å…ƒ |
| macd_dif | æœ¬åœ°è®¡ç®— | MACD-DIF | - |
| macd_dea | æœ¬åœ°è®¡ç®— | MACD-DEA | - |
| macd | æœ¬åœ°è®¡ç®— | MACDæŸ± | - |

## ğŸ”§ æŠ€æœ¯æŒ‡æ ‡è®¡ç®—æ–¹æ³•

### 1. ç§»åŠ¨å¹³å‡çº¿ï¼ˆMAï¼‰

**æˆ‘ä»¬çš„å®ç°**: `DataFetcher.calculate_ma()`

```python
# è®¡ç®—5æ—¥å‡çº¿
df['ma5'] = fetcher.calculate_ma(df, period=5, price_col='close')

# è®¡ç®—20æ—¥å‡çº¿
df['ma20'] = fetcher.calculate_ma(df, period=20, price_col='close')
```

**è®¡ç®—å…¬å¼**:
```
MA(n) = (P1 + P2 + ... + Pn) / n
```
å…¶ä¸­ P ä¸ºæ”¶ç›˜ä»·ï¼Œn ä¸ºå‘¨æœŸ

### 2. MACDæŒ‡æ ‡

**æˆ‘ä»¬çš„å®ç°**: `DataFetcher.calculate_macd()`

```python
macd_data = fetcher.calculate_macd(
    df,
    fast=12,    # å¿«çº¿å‘¨æœŸ
    slow=26,    # æ…¢çº¿å‘¨æœŸ
    signal=9    # ä¿¡å·çº¿å‘¨æœŸ
)

df['macd_dif'] = macd_data['dif']
df['macd_dea'] = macd_data['dea']
df['macd'] = macd_data['macd']
```

**è®¡ç®—å…¬å¼**:
```
EMA(fast) = å¿«é€ŸæŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿ï¼ˆé»˜è®¤12æ—¥ï¼‰
EMA(slow) = æ…¢é€ŸæŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿ï¼ˆé»˜è®¤26æ—¥ï¼‰

DIF = EMA(fast) - EMA(slow)
DEA = DIFçš„9æ—¥EMA
MACD = 2 Ã— (DIF - DEA)
```

## ğŸ“Š è‚¡ç¥¨ä»£ç æ ¼å¼è§„èŒƒ

æ ¹æ® [å®˜æ–¹æ–‡æ¡£](https://tushare.pro/document/2?doc_id=14)ï¼ŒTushareçš„è‚¡ç¥¨ä»£ç è§„åˆ™ï¼š

| äº¤æ˜“æ‰€ | ä»£ç  | åç¼€ | ç¤ºä¾‹ |
|-------|------|------|------|
| ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ | SSE | .SH | 600000.SHï¼ˆè‚¡ç¥¨ï¼‰<br>000001.SHï¼ˆæŒ‡æ•°ï¼‰ |
| æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ | SZSE | .SZ | 000001.SZï¼ˆè‚¡ç¥¨ï¼‰<br>399005.SZï¼ˆæŒ‡æ•°ï¼‰ |
| åŒ—äº¬è¯åˆ¸äº¤æ˜“æ‰€ | BSE | .BJ | 430xxx.BJ |
| é¦™æ¸¯è¯åˆ¸äº¤æ˜“æ‰€ | HKEX | .HK | 00001.HK |

**æˆ‘ä»¬çš„è‡ªåŠ¨è¯†åˆ«é€»è¾‘** (`_format_stock_code()`):

```python
def _format_stock_code(self, code: str) -> str:
    """
    è‡ªåŠ¨è¯†åˆ«å¹¶æ·»åŠ äº¤æ˜“æ‰€åç¼€
    
    è¾“å…¥ -> è¾“å‡º
    '000001' -> '000001.SZ'  (0å¼€å¤´=æ·±åœ³)
    '600000' -> '600000.SH'  (6å¼€å¤´=ä¸Šæµ·)
    '300750' -> '300750.SZ'  (3å¼€å¤´=åˆ›ä¸šæ¿)
    '000001.SZ' -> '000001.SZ' (å·²æœ‰åç¼€)
    """
    if '.' in code:
        return code
    
    if code.startswith('6'):
        return f"{code}.SH"
    elif code.startswith(('0', '3')):
        return f"{code}.SZ"
    else:
        raise ValueError(f"æ— æ³•è¯†åˆ«çš„è‚¡ç¥¨ä»£ç : {code}")
```

## ğŸ”„ å¤æƒç±»å‹è¯´æ˜

æ ¹æ® [å®˜æ–¹æ–‡æ¡£](https://tushare.pro/document/2?doc_id=109)ï¼Œå¤æƒå‚æ•°ï¼ˆadjï¼‰ï¼š

| å‚æ•°å€¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|-------|------|---------|
| `None` | ä¸å¤æƒ | æŸ¥çœ‹çœŸå®å†å²ä»·æ ¼ |
| `'qfq'` | å‰å¤æƒ | **æ¨è**ï¼ŒæŠ€æœ¯åˆ†æã€å›æµ‹ |
| `'hfq'` | åå¤æƒ | ä¿æŒå†å²ä»·æ ¼ä¸å˜ |

**å‰å¤æƒç¤ºä¾‹**:
```python
# å‰å¤æƒï¼šä¿æŒæœ€æ–°ä»·æ ¼ä¸å˜ï¼Œè°ƒæ•´å†å²ä»·æ ¼
df = analyzer.get_complete_data(
    stock_code='600519',  # è´µå·èŒ…å°
    start_date='20240101',
    adjust='qfq'  # å‰å¤æƒ
)
```

**æ³¨æ„äº‹é¡¹**ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰:
- å¤æƒæœºåˆ¶æ˜¯æ ¹æ® `end_date` å‚æ•°åŠ¨æ€å¤æƒ
- é‡‡ç”¨åˆ†çº¢å†æŠ•æ¨¡å¼
- ç›®å‰åªæ”¯æŒæ—¥çº¿å¤æƒ

## ğŸ“… æ—¥æœŸæ ¼å¼è§„èŒƒ

æ ¹æ®å®˜æ–¹æ–‡æ¡£è¦æ±‚ï¼Œæ—¥æœŸæ ¼å¼å¿…é¡»æ˜¯ï¼š**YYYYMMDD**

**æˆ‘ä»¬çš„å¤„ç†**:
```python
# æˆ‘ä»¬æ”¯æŒä¸¤ç§æ ¼å¼ï¼Œéƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºYYYYMMDD
start_date = '20240101'      # âœ“ æ¨èæ ¼å¼
start_date = '2024-01-01'    # âœ“ ä¹Ÿæ”¯æŒï¼Œè‡ªåŠ¨è½¬æ¢ä¸º20240101

# å†…éƒ¨è½¬æ¢é€»è¾‘
start_date = start_date.replace('-', '')
```

## ğŸ” ç§¯åˆ†è¦æ±‚

æ ¹æ® [å®˜æ–¹ç§¯åˆ†è¯´æ˜](https://tushare.pro/document/1?doc_id=13)ï¼š

| æ¥å£ | æœ€ä½ç§¯åˆ† | æ— é™åˆ¶ç§¯åˆ† |
|-----|---------|----------|
| pro_barï¼ˆæ—¥çº¿ï¼‰ | 120 | 2000 |
| daily_basic | 2000 | 5000 |
| åˆ†é’Ÿæ•°æ® | 600 | 2000 |

**æœ¬é¡¹ç›®éœ€è¦**:
- åŸºç¡€åŠŸèƒ½ï¼š120ç§¯åˆ†ï¼ˆä»…è¡Œæƒ…æ•°æ®ï¼‰
- å®Œæ•´åŠŸèƒ½ï¼š**2000ç§¯åˆ†**ï¼ˆåŒ…å«å¸‚å€¼ã€é‡æ¯”ç­‰ï¼‰

## ğŸ¯ APIè°ƒç”¨é™åˆ¶

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼š

| ç§¯åˆ†ç­‰çº§ | æ¯åˆ†é’Ÿè°ƒç”¨æ¬¡æ•° | å•æ¬¡è¿”å›æ¡æ•° |
|---------|--------------|-------------|
| 120ç§¯åˆ† | 120æ¬¡ | 6000æ¡ |
| 2000ç§¯åˆ† | 200æ¬¡ | 6000æ¡ |
| 5000ç§¯åˆ† | æ— é™åˆ¶ | 6000æ¡ |

**æ³¨æ„**:
- å•æ¬¡è¯·æ±‚æœ€å¤šè¿”å›6000æ¡æ•°æ®
- ä¸€æ¬¡è¯·æ±‚çº¦ç­‰äºä¸€ä¸ªè‚¡ç¥¨23å¹´å†å²æ•°æ®
- å¦‚éœ€æ›´å¤šæ•°æ®ï¼Œè¯·åˆ†æ‰¹è¯·æ±‚

## ğŸ“– ç›¸å…³æ–‡æ¡£é“¾æ¥

### Tushareå®˜æ–¹æ–‡æ¡£
- [Tushare Proé¦–é¡µ](https://tushare.pro/)
- [æ²ªæ·±è‚¡ç¥¨æ•°æ®](https://tushare.pro/document/2?doc_id=14)
- [é€šç”¨è¡Œæƒ…æ¥å£](https://tushare.pro/document/2?doc_id=109)
- [æ¯æ—¥æŒ‡æ ‡æ¥å£](https://tushare.pro/document/2?doc_id=32)
- [å†å²æ—¥çº¿æ¥å£](https://tushare.pro/document/2?doc_id=27)
- [æ•°æ®å·¥å…·ï¼ˆåœ¨çº¿è°ƒè¯•ï¼‰](https://tushare.pro/webclient/)
- [ç§¯åˆ†è·å–æ–¹æ³•](https://tushare.pro/document/1?doc_id=13)
- [å¸¸è§é—®é¢˜](https://tushare.pro/document/1?doc_id=122)

### æœ¬é¡¹ç›®æ–‡æ¡£
- [README.md](README.md) - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
- [QUICKSTART.md](QUICKSTART.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [example.py](example.py) - ä½¿ç”¨ç¤ºä¾‹ä»£ç 

## âš ï¸ é‡è¦è¯´æ˜

1. **æ•°æ®å•ä½æ³¨æ„**:
   - æ€»å¸‚å€¼ã€æµé€šå¸‚å€¼ï¼š**ä¸‡å…ƒ**ï¼ˆéœ€é™¤ä»¥10000è½¬æ¢ä¸ºäº¿å…ƒï¼‰
   - æˆäº¤é¢ï¼š**åƒå…ƒ**ï¼ˆéœ€é™¤ä»¥1000è½¬æ¢ä¸ºå…ƒï¼‰
   - æˆäº¤é‡ï¼š**æ‰‹**ï¼ˆ1æ‰‹=100è‚¡ï¼‰

2. **æ—¥æœŸæ ¼å¼**:
   - è¾“å…¥ï¼šYYYYMMDD æˆ– YYYY-MM-DD
   - è¾“å‡ºï¼špandas.Timestamp å¯¹è±¡

3. **åœç‰ŒæœŸé—´**:
   - è¡Œæƒ…æ•°æ®ä¸ä¼šè¿”å›
   - å¯èƒ½å¯¼è‡´DataFrameä¸­æŸäº›æ—¥æœŸç¼ºå¤±

4. **æŠ€æœ¯æŒ‡æ ‡**:
   - MAæŒ‡æ ‡éœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®ï¼ˆå¦‚MA20éœ€è¦è‡³å°‘20ä¸ªäº¤æ˜“æ—¥ï¼‰
   - MACDæŒ‡æ ‡éœ€è¦è‡³å°‘34ä¸ªäº¤æ˜“æ—¥ï¼ˆ26+9-1ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-22  
**åŸºäº**: Tushare Proå®˜æ–¹æ–‡æ¡£

